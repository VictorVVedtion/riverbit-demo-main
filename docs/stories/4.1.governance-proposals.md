# Story 4.1: 治理提案系统

## Status
Approved

## Story
**As a** RiverBit 社区成员,
**I want** 创建和查看治理提案,
**so that** 可以参与协议治理并影响平台发展。

## Acceptance Criteria
1. 支持创建参数修改提案 (最低质押 1000 STAKE)
2. 支持创建文本提案
3. 提案列表展示 (Active/Passed/Rejected/Failed)
4. 提案详情页完整展示
5. 提案创建表单验证

## Dev Notes

### 提案创建 (链端)

```go
// 使用 Cosmos SDK x/gov 模块
// protocol/x/gov 已内置,只需配置参数

// app.toml 配置
[gov]
min_deposit = "1000000000stake"  // 1000 STAKE
voting_period = "604800s"        // 7 天
quorum = "0.4"                   // 40% 投票率
threshold = "0.5"                // 50% Yes
veto_threshold = "0.334"         // 33.4% NoWithVeto
```

### 前端 Hook

```typescript
// src/hooks/useProposals.ts
import { useState, useEffect } from 'react';
import { useRiverChain } from '../contexts/RiverChainContext';

interface Proposal {
  id: string;
  title: string;
  description: string;
  status: 'ACTIVE' | 'PASSED' | 'REJECTED' | 'FAILED';
  submitTime: number;
  votingEndTime: number;
  totalDeposit: string;
}

export function useProposals() {
  const { client } = useRiverChain();
  const [proposals, setProposals] = useState<Proposal[]>([]);

  useEffect(() => {
    if (!client) return;

    client.query('/cosmos.gov.v1beta1.Query/Proposals', {
      proposalStatus: 0, // All
    }).then(res => {
      setProposals(res.proposals);
    });
  }, [client]);

  return { proposals };
}

// 创建提案
export function useCreateProposal() {
  const { client, address } = useRiverChain();
  const [isCreating, setIsCreating] = useState(false);

  const createProposal = async (
    title: string,
    description: string,
    deposit: string
  ) => {
    if (!client || !address) return null;

    setIsCreating(true);
    try {
      const msg = {
        typeUrl: '/cosmos.gov.v1beta1.MsgSubmitProposal',
        value: {
          content: {
            typeUrl: '/cosmos.gov.v1beta1.TextProposal',
            value: { title, description },
          },
          initialDeposit: [{ denom: 'stake', amount: deposit }],
          proposer: address,
        },
      };

      const result = await client.signAndBroadcast(address, [msg], 'auto');
      return result.code === 0;
    } catch (err) {
      console.error(err);
      return false;
    } finally {
      setIsCreating(false);
    }
  };

  return { createProposal, isCreating };
}
```

### 提案列表组件

```typescript
// src/components/governance/ProposalList.tsx
import { useProposals } from '../../hooks/useProposals';
import { Link } from 'react-router-dom';

export default function ProposalList() {
  const { proposals } = useProposals();

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'ACTIVE': return 'text-blue-500';
      case 'PASSED': return 'text-green-500';
      case 'REJECTED': return 'text-red-500';
      default: return 'text-gray-400';
    }
  };

  return (
    <div className="space-y-4">
      <h2 className="text-2xl font-bold">治理提案</h2>

      {proposals.map(proposal => (
        <Link
          key={proposal.id}
          to={`/governance/${proposal.id}`}
          className="block p-6 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors"
        >
          <div className="flex items-start justify-between">
            <div className="flex-1">
              <h3 className="text-lg font-semibold mb-2">
                #{proposal.id} {proposal.title}
              </h3>
              <p className="text-gray-400 line-clamp-2">
                {proposal.description}
              </p>
            </div>
            <div className={`ml-4 font-semibold ${getStatusColor(proposal.status)}`}>
              {proposal.status}
            </div>
          </div>

          <div className="mt-4 flex items-center space-x-6 text-sm text-gray-400">
            <div>提交时间: {new Date(proposal.submitTime).toLocaleDateString()}</div>
            {proposal.status === 'ACTIVE' && (
              <div>投票截止: {new Date(proposal.votingEndTime).toLocaleDateString()}</div>
            )}
          </div>
        </Link>
      ))}
    </div>
  );
}
```

[Source: Cosmos SDK Governance]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Initial creation | Scrum Master Bob |
