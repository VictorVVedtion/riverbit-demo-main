# Story 4.3: ä¸»ç½‘éƒ¨ç½²å‡†å¤‡

## Status
Approved

## Story
**As a** DevOps å·¥ç¨‹å¸ˆ,
**I want** å®Œæˆä¸»ç½‘éƒ¨ç½²çš„æ‰€æœ‰å‡†å¤‡å·¥ä½œ,
**so that** å¯ä»¥å®‰å…¨ç¨³å®šåœ°å¯åŠ¨ RiverBit ä¸»ç½‘ã€‚

## Acceptance Criteria
1. åˆ›ä¸–æ–‡ä»¶é…ç½®å®Œæˆå¹¶éªŒè¯
2. éƒ¨ç½²æ–‡æ¡£å®Œæ•´ (èŠ‚ç‚¹é…ç½®ã€ç½‘ç»œæ‹“æ‰‘)
3. å®‰å…¨å®¡è®¡æ¸…å•å®Œæˆ
4. ç›‘æ§ç³»ç»Ÿé…ç½®å°±ç»ª
5. åº”æ€¥é¢„æ¡ˆæ–‡æ¡£å®Œå¤‡

## Dev Notes

### åˆ›ä¸–æ–‡ä»¶é…ç½®

```json
// genesis.json
{
  "chain_id": "riverchain-1",
  "genesis_time": "2025-10-25T00:00:00Z",
  "app_state": {
    "auth": {
      "accounts": [
        {
          "@type": "/cosmos.auth.v1beta1.BaseAccount",
          "address": "river1...",
          "pub_key": null,
          "account_number": "0",
          "sequence": "0"
        }
      ]
    },
    "bank": {
      "balances": [
        {
          "address": "river1...",
          "coins": [
            { "denom": "stake", "amount": "100000000000" }
          ]
        }
      ]
    },
    "staking": {
      "params": {
        "unbonding_time": "1814400s",
        "max_validators": 100,
        "bond_denom": "stake"
      }
    },
    "gov": {
      "deposit_params": {
        "min_deposit": [
          { "denom": "stake", "amount": "1000000000" }
        ],
        "max_deposit_period": "172800s"
      },
      "voting_params": {
        "voting_period": "604800s"
      },
      "tally_params": {
        "quorum": "0.4",
        "threshold": "0.5",
        "veto_threshold": "0.334"
      }
    },
    "feetiers": {
      "params": {
        "tiers": [
          { "tier": 1, "maker_fee_ppm": -100, "taker_fee_ppm": 500 },
          { "tier": 2, "maker_fee_ppm": -50, "taker_fee_ppm": 400 },
          { "tier": 3, "maker_fee_ppm": 0, "taker_fee_ppm": 300 },
          { "tier": 4, "maker_fee_ppm": 0, "taker_fee_ppm": 200 }
        ]
      }
    },
    "affiliates": {
      "params": {
        "referral_code_length": 8,
        "reward_ratio": "0.10"
      }
    },
    "revshare": {
      "params": {
        "tier_ratios": {
          "1": "0.20",
          "2": "0.10",
          "3": "0.05"
        },
        "settlement_period": "86400s"
      }
    }
  }
}
```

### éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# scripts/deploy-mainnet.sh

set -e

echo "ğŸš€ RiverBit ä¸»ç½‘éƒ¨ç½²è„šæœ¬"

# 1. æ£€æŸ¥ç¯å¢ƒ
echo "æ£€æŸ¥ Go ç‰ˆæœ¬..."
go version | grep "go1.21" || (echo "éœ€è¦ Go 1.21+" && exit 1)

# 2. ç¼–è¯‘äºŒè¿›åˆ¶
echo "ç¼–è¯‘ riverchaind..."
cd protocol
make install

# 3. åˆå§‹åŒ–èŠ‚ç‚¹
echo "åˆå§‹åŒ–èŠ‚ç‚¹..."
riverchaind init <moniker> --chain-id riverchain-1

# 4. å¤åˆ¶åˆ›ä¸–æ–‡ä»¶
echo "ä¸‹è½½åˆ›ä¸–æ–‡ä»¶..."
curl -s https://raw.githubusercontent.com/RiverBit-dex/riverchain/main/genesis.json \
  > ~/.riverchain/config/genesis.json

# 5. é…ç½®ç§å­èŠ‚ç‚¹
echo "é…ç½®ç§å­èŠ‚ç‚¹..."
sed -i 's/seeds = ""/seeds = "seed1@ip:26656,seed2@ip:26656"/' \
  ~/.riverchain/config/config.toml

# 6. é…ç½®æŒä¹…èŠ‚ç‚¹
sed -i 's/persistent_peers = ""/persistent_peers = "peer1@ip:26656"/' \
  ~/.riverchain/config/config.toml

# 7. å¯åŠ¨èŠ‚ç‚¹
echo "å¯åŠ¨èŠ‚ç‚¹..."
riverchaind start --home ~/.riverchain
```

### ç›‘æ§ç³»ç»Ÿé…ç½®

```yaml
# docker-compose.monitoring.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards

  node-exporter:
    image: prom/node-exporter:latest
    ports:
      - "9100:9100"

volumes:
  prometheus_data:
  grafana_data:
```

```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'riverchain'
    static_configs:
      - targets: ['localhost:26660']  # Tendermint metrics

  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
```

### å®‰å…¨å®¡è®¡æ¸…å•

```markdown
# å®‰å…¨å®¡è®¡æ¸…å•

## æ™ºèƒ½åˆçº¦å®¡è®¡
- [ ] BridgeAdapter.sol å®¡è®¡å®Œæˆ
  - [ ] è®¿é—®æ§åˆ¶æ£€æŸ¥
  - [ ] é‡å…¥æ”»å‡»é˜²æŠ¤
  - [ ] æ•´æ•°æº¢å‡ºæ£€æŸ¥
  - [ ] äº‹ä»¶æ—¥å¿—å®Œæ•´æ€§

## é“¾ç«¯ä»£ç å®¡è®¡
- [ ] x/affiliates æ¨¡å—å®¡è®¡
  - [ ] å¾ªç¯æ¨èæ£€æµ‹
  - [ ] æ¨èç å”¯ä¸€æ€§
- [ ] x/revshare æ¨¡å—å®¡è®¡
  - [ ] ç²¾åº¦è®¡ç®—å‡†ç¡®æ€§
  - [ ] ç»“ç®—é€»è¾‘æ­£ç¡®æ€§
- [ ] x/bridge æ¨¡å—å®¡è®¡
  - [ ] è·¨é“¾æ¶ˆæ¯éªŒè¯
  - [ ] ä½™é¢ä¸€è‡´æ€§

## å¯†é’¥ç®¡ç†
- [ ] éªŒè¯èŠ‚ç‚¹å¯†é’¥å®‰å…¨å­˜å‚¨
- [ ] å¤šç­¾é’±åŒ…é…ç½® (2/3)
- [ ] å†·é’±åŒ…å¤‡ä»½

## ç½‘ç»œå®‰å…¨
- [ ] DDoS é˜²æŠ¤é…ç½®
- [ ] é˜²ç«å¢™è§„åˆ™
- [ ] SSL/TLS è¯ä¹¦

## æ•°æ®å®‰å…¨
- [ ] æ•°æ®åº“å¤‡ä»½ç­–ç•¥ (æ¯æ—¥)
- [ ] é“¾æ•°æ®å¿«ç…§ (æ¯å‘¨)
- [ ] ç¾éš¾æ¢å¤æ¼”ç»ƒ
```

### åº”æ€¥é¢„æ¡ˆ

```markdown
# åº”æ€¥é¢„æ¡ˆ

## åœºæ™¯ 1: èŠ‚ç‚¹å®•æœº
### ç—‡çŠ¶
- èŠ‚ç‚¹åœæ­¢å‡ºå—
- æ— æ³•è¿æ¥ RPC

### åº”æ€¥æ­¥éª¤
1. æ£€æŸ¥èŠ‚ç‚¹æ—¥å¿—: `journalctl -u riverchain -f`
2. æ£€æŸ¥ç£ç›˜ç©ºé—´: `df -h`
3. é‡å¯èŠ‚ç‚¹: `systemctl restart riverchain`
4. å¦‚æ— æ³•æ¢å¤,ä»å¿«ç…§æ¢å¤

## åœºæ™¯ 2: é“¾åœæ­¢
### ç—‡çŠ¶
- å…¨ç½‘èŠ‚ç‚¹åœæ­¢å‡ºå—
- å…±è¯†å¤±è´¥

### åº”æ€¥æ­¥éª¤
1. éªŒè¯èŠ‚ç‚¹æŠ•ç¥¨åœæ­¢é“¾
2. å®šä½é—®é¢˜ä»£ç /é…ç½®
3. å‡†å¤‡ä¿®å¤è¡¥ä¸
4. åè°ƒéªŒè¯èŠ‚ç‚¹å‡çº§
5. é‡å¯é“¾

## åœºæ™¯ 3: å®‰å…¨æ¼æ´
### ç—‡çŠ¶
- å¼‚å¸¸äº¤æ˜“
- èµ„é‡‘æŸå¤±

### åº”æ€¥æ­¥éª¤
1. ç«‹å³æš‚åœå—å½±å“æ¨¡å—
2. é€šçŸ¥æ‰€æœ‰éªŒè¯èŠ‚ç‚¹
3. å¯åŠ¨ç´§æ€¥æ²»ç†ææ¡ˆ
4. ä¿®å¤æ¼æ´å¹¶å®¡è®¡
5. è¡¥å¿å—å½±å“ç”¨æˆ·

## è”ç³»æ–¹å¼
- æŠ€æœ¯è´Ÿè´£äºº: xxx
- å®‰å…¨å›¢é˜Ÿ: xxx
- ç¤¾åŒºç®¡ç†: xxx
```

### éƒ¨ç½²æ–‡æ¡£

```markdown
# RiverBit ä¸»ç½‘éƒ¨ç½²æ–‡æ¡£

## ç³»ç»Ÿè¦æ±‚
- CPU: 4 æ ¸
- å†…å­˜: 16GB
- å­˜å‚¨: 500GB SSD
- ç½‘ç»œ: 100Mbps

## éªŒè¯èŠ‚ç‚¹é…ç½®

### 1. å®‰è£…ä¾èµ–
```bash
# Ubuntu 22.04
sudo apt update
sudo apt install build-essential git jq -y

# å®‰è£… Go 1.21
wget https://go.dev/dl/go1.21.6.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.6.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
```

### 2. ç¼–è¯‘èŠ‚ç‚¹
```bash
git clone https://github.com/RiverBit-dex/riverchain.git
cd riverchain
make install
```

### 3. åˆ›å»ºæœåŠ¡
```bash
sudo tee /etc/systemd/system/riverchain.service > /dev/null <<EOF
[Unit]
Description=RiverChain Node
After=network.target

[Service]
User=$USER
ExecStart=$(which riverchaind) start
Restart=on-failure
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl enable riverchain
sudo systemctl start riverchain
```

### 4. éªŒè¯
```bash
riverchaind status
# æ£€æŸ¥ catching_up: false
```

## åˆ›å»ºéªŒè¯èŠ‚ç‚¹

```bash
# 1. åˆ›å»ºéªŒè¯èŠ‚ç‚¹å¯†é’¥
riverchaind keys add validator

# 2. åˆ›å»ºéªŒè¯èŠ‚ç‚¹
riverchaind tx staking create-validator \
  --amount=100000000stake \
  --pubkey=$(riverchaind tendermint show-validator) \
  --moniker="MyValidator" \
  --commission-rate="0.10" \
  --commission-max-rate="0.20" \
  --commission-max-change-rate="0.01" \
  --min-self-delegation="1" \
  --from=validator \
  --chain-id=riverchain-1
```

## ç›‘æ§é…ç½®

```bash
# å¯åŠ¨ç›‘æ§
docker-compose -f docker-compose.monitoring.yml up -d

# è®¿é—® Grafana
# http://localhost:3000
# ç”¨æˆ·å: admin
# å¯†ç : admin
```
```

[Source: Cosmos SDK Deployment Guide]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Initial creation | Scrum Master Bob |
